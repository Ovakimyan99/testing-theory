# Честность и хрупкость

Честность и хрупкость - эти два термина определяют качество написанных тестов
Нам надо, чтобы тесты были честными и не хрупкими.

Честность тестов заставляет нас требовать, что модуль "А" нерабочий тогда, когда мы дописываем
тесты, которые подтверждают, что этот модуль нерабочий. И если мы знаем, что модуль
"А" имеет зависимости от других узлов системы, мы как-то заменяем эти другие узлы
системы на другие вещи для того, чтобы ошибка в других узлах системы не приводила
к ошибкам тестах "А"

Тест не является хрупких, если рефакторинг модуля А, при котором внешнее поведение
сохраняется, не приводит к падению теста. (*)

(*) А именно представим себе какой-то модуль, который имеет внутри себя класс
с методом `getCurrentDiscount`, где она возвращает текущую скидку.

И предположим, что этот метод вызывает другой метод, потому что расчет скидки -
это сложно: `getDiscountForLoyalty`. И этот метод не является частью публичного
API.

Но если мы используем класс и мы не используем приватные методы, что просто не
всегда возможно, например, в прокси, то появляется соблазн протестировать еще и
`getDiscountForLoyalty`. Но это будет неправильно!

Почему?

- Потому что я должен сохранить возможность полностью порефакторить `getCurrentDiscount`,
- что она будет вызывать совершенно другие функции
- переименовать название самого метода, потому что мне показалось, что оно странное
- разделить `getDiscountForLoyalty` на другие подфункции и так далее
И тест должен оставаться зеленым!
Хрупкий тест - это тест, который слишком много знает о внутреннем состоянии и
его внутренней реализации.

То есть я не имею права ни делать предположений о том, что хранится, ни делать
предположений, что у него есть приватные методы.

Но может возникнуть действительно резонный вопрос, а что если `getDiscountForLoyalty`
имеет свою специфическую логику и мы хотим ее протестировать?

У нас на этот случай есть 2 классических выхода:

1. Не делать этого
2. Но если надо, то мы можем вынести ее в отдельный модуль (*)

\* Эта функция принимает все необходимое для расчета.
Она может делать Ajax запрос для получения данных и вроде нам это не мешает
тестировать, но, давайте вернемся к понятию `честность`.

Ajax запрос - это самый распространенный побочный эффект.
Что если наш сервер упадет? Тогда тест больше не честным, сломается, а значит
будет плохим.

Поэтому Ajax запросы тоже надо будет подменять. Дальше мы поговорим, как должна
выглядеть структура хорошего unit теста и что с ней делать.
